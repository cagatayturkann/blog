<!DOCTYPE html>
<html lang="en-us"
    dir="ltr"><head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1">
    <title>
    
    Building Intelligent E-commerce Experiences with RAG - Ã‡aÄŸatay TÃ¼rkan
    
</title>
    
    
    
    
    
    
    <meta name="keywords" content="SEO keywords">
    <meta name="description" content="SEO description">
    <link rel="canonical" href="http://localhost:1313/blog/en/building-intelligent-ecommerce-rag-copy/" />
    <link rel="icon" href="/favicon.ico?v=1741958241" type="image/x-icon">
    
<link rel="stylesheet" href="/blog/css/app.css">
    
<script src="/blog/js/main.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.10/dist/cdn.min.js"></script>

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    
    

    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id="></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-NRES0X4BGY');
    </script>
    

    
    
</head><body>
    <div class="
        mx-auto max-w-[calc(120rem)]
        min-h-screen
        2xl:px-[calc(16rem)]
        xl:px-24
        md:px-8
        px-4
    ">

        <div x-data="{ openMenu: false }" class="relative">
    <nav class="flex flex-1 flex-col lg:flex-row items-center justify-between">
        <a href="/">
            <img src="/blog/images/author.jpeg" alt="site logo"
                class="w-16 h-16 my-5 p-1 bg-gray-100 rounded-full cursor-pointer hover:scale-110" />
        </a>
        <div class="hidden lg:block" :class="{'hidden': !openMenu}">
            






<ul
    class="flex flex-col lg:flex-row justify-end mt-2 sm:mt-5 mb-5 pb-2 font-light text-xl lg:text-2xl gap-5 lg:gap-1 text-center">
    








<li>
    <a    class="px-5 lg:px-10 py-3 font-light hover:border-b-2 hover:border-red-500"     href="/blog/en/"  >Home</a>
    
</li>







<li>
    <a    class="px-5 lg:px-10 py-3 font-light hover:border-b-2 hover:border-red-500"     href="/blog/en/categories/"  >Categories</a>
    
</li>







<li>
    <a    class="px-5 lg:px-10 py-3 font-light hover:border-b-2 hover:border-red-500"     href="/blog/en/tags/"  >Tags</a>
    
</li>

<li class="flex items-center gap-2">
    
        
            
                <a href="http://localhost:1313/blog/en/building-intelligent-ecommerce-rag/" class="text-gray-500 hover:text-gray-300 text-lg">ðŸ‡ºðŸ‡¸ EN</a>
            
            
        
            
                <a href="http://localhost:1313/blog/tr/building-intelligent-ecommerce-rag/" class="text-gray-500 hover:text-gray-300 text-lg">ðŸ‡¹ðŸ‡· TR</a>
            
            
                <span class="text-gray-600">|</span>
            
        
    
</li>

</ul>




        </div>
    </nav>
    <div class="absolute top-8 right-5 flex items-center lg:hidden">
        
        <button @click="openMenu = !openMenu" type="button"
            class="relative inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-800 hover:text-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
            aria-controls="mobile-menu" aria-expanded="openMenu">
            
            <svg x-show="!openMenu" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
            
            <svg x-show="openMenu" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
</div>

        <header class="flex flex-col w-full items-center justify-center text-white pt-8 pb-8">
    <div class="w-full">
        <div class="flex flex-1 flex-row justify-between">
            <h2 class="w-full text-center text-3xl sm:text-5xl font-crimson font-bold tracking-tight text-gray-300">
                <a href="http://localhost:1313/blog/">Ã‡aÄŸatay TÃ¼rkan</a>
            </h2>
        </div>
        <p
            class="w-full text-center pl-1 pb-4 sm:pt-3 sm:pb-0 font-crimson font-normal text-xl sm:text-2xl leading-8 text-gray-500">
            Trust me! I am an Engineer.</p>
    </div>

    
    <div class="flex justify-center w-full max-w-4xl mx-auto">
        <div class="flex justify-between w-32 px-12 mt-3">
            <a href="https://www.linkedin.com/in/cagatayturkann/" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-100 transition-colors duration-200">
                <i class="fab fa-linkedin text-2xl"></i>
            </a>
            <a href="https://github.com/cagatayturkann" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-100 transition-colors duration-200">
                <i class="fab fa-github text-2xl"></i>
            </a>
            <a href="https://www.instagram.com/cagatayturkann/" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-100 transition-colors duration-200">
                <i class="fab fa-instagram text-2xl"></i>
            </a>
            <a href="https://x.com/cagatayturkann" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-100 transition-colors duration-200">
                <i class="fab fa-x-twitter text-2xl"></i>
            </a>
            <a href="https://facebook.com/cagatayturkann" target="_blank" rel="noopener noreferrer" class="text-gray-500 hover:text-gray-100 transition-colors duration-200">
                <i class="fab fa-facebook text-2xl"></i>
            </a>
        </div>
    </div>

    <div class="relative w-9/12 lg:w-1/2 h-12 my-5">
        <form action="/blog/en/search" method="get">
            <input
                class="bg-gray-800 placeholder:italic placeholder:text-gray-600 w-full h-12 rounded-full mt-1 pl-5 pr-5 border border-gray-800 text-gray-100"
                placeholder='Input Keywords...' type="text" name="q" id="search-input" />
            <button type="submit" class="absolute inset-y-2 right-1 w-28 h-10 font-light bg-gray-900 hover:bg-red-500 text-gray-500 hover:text-gray-100 rounded-full cursor-pointer">
                Search
            </button>
        </form>
    </div>

    
    <div class="w-full flex flex-row justify-start text-gray-500 text-lg px-1 border-l-4 border-l-red-500">
        <ul class="flex flex-row gap-x-2">
            <li class="">
                <a href="/" class="hover:text-gray-100">Home</a>
            </li>
            
            <li>
                &gt;&nbsp;&nbsp;<a href="/blog/en/building-intelligent-ecommerce-rag-copy/" class="hover:text-gray-100">Building Intelligent E-commerce Experiences with RAG</a>
            </li>
            
        </ul>
    </div>
    <div class="w-full h-2 border-b border-b-gray-600/50 border-dashed font-light text-gray-300">
    </div>
    

</header>

        <div class="
            flex flex-col overflow-hidden
            xl:px-0
            lg:flex-row lg:space-x-8
        ">
            <main class="w-full overflow-hidden">
                

<article class="single-article">
    <div class="group relative">
        <h1 class="text-3xl font-medium leading-10 text-gray-400 hover:text-gray-100">
            <a href="/blog/en/building-intelligent-ecommerce-rag-copy/">
                Building Intelligent E-commerce Experiences with RAG
            </a>
        </h1>
        <div class="flex justify-between items-center">
            <time class="flex items-center py-2 text-xl text-gray-600">
                2025-03-14 10:00
                &nbsp;&nbsp;|&nbsp;&nbsp;23 minute read
            </time>
            
<div class="language-switch flex items-center space-x-2 text-gray-500 hover:text-gray-300">
    
    <a href="http://localhost:1313/blog/en/building-intelligent-ecommerce-rag/" class="flex items-center space-x-1">
        
        <span>ðŸ‡¬ðŸ‡§</span>
        <span class="text-sm">English</span>
        
    </a>
    
    <a href="http://localhost:1313/blog/tr/building-intelligent-ecommerce-rag/" class="flex items-center space-x-1">
        
        <span>ðŸ‡¹ðŸ‡·</span>
        <span class="text-sm">TÃ¼rkÃ§e</span>
        
    </a>
    
</div>
 
        </div>

        
        <div class="my-6">
            <img src="/blog/en/building-intelligent-ecommerce-rag/images/cover.svg" alt="Building Intelligent E-commerce Experiences with RAG" class="w-full rounded-lg shadow-lg">
        </div>
        

        <div class="mt-1 lg:pb-10 px-2 overflow-hidden break-words article-body">
            <div class="text-gray-500">
                <style>
                    .article-body h1 { font-size: 36px; font-weight: 700; margin: 1.5rem 0 1rem; color: #9ca3af; }
                    .article-body h2 { font-size: 30px; font-weight: 600; margin: 1.25rem 0 0.75rem; color: #9ca3af; }
                    .article-body h3 { font-size: 26px; font-weight: 500; margin: 1rem 0 0.5rem; color: #9ca3af; }
                    .article-body p { font-size: 20px; line-height: 1.8; margin: 0.75rem 0; }
                    .article-body ul, .article-body ol { margin: 0.75rem 0; padding-left: 1.5rem; }
                    .article-body li { font-size: 20px; line-height: 1.8; }
                    .article-body strong { font-weight: 600; color: #d1d5db; }
                    .article-body pre { background-color: #111827; font-size: 0.875rem; padding: 1rem; border-radius: 0.375rem; }
                </style>
                <h1 id="building-intelligent-e-commerce-experiences-with-rag">Building Intelligent E-commerce Experiences with RAG</h1>
<h2 id="introduction">Introduction</h2>
<p>E-commerce platforms are constantly evolving to provide more personalized and efficient shopping experiences. Traditional search and recommendation systems often fall short when it comes to understanding the nuanced intent behind customer queries. This is where Retrieval-Augmented Generation (RAG) comes in, combining the power of large language models with precise information retrieval to create more intelligent shopping assistants.</p>
<p>In this article, we&rsquo;ll explore how to implement a RAG-based e-commerce assistant that can:</p>
<ul>
<li>Understand and respond to complex product queries</li>
<li>Maintain conversation context for follow-up questions</li>
<li>Support multiple languages seamlessly</li>
<li>Provide accurate product information from a vector database</li>
<li>Generate human-like responses while avoiding hallucinations</li>
</ul>
<p>You can access the complete code for this project at <a href="https://github.com/cagatayturkann/ecommerceRAG">GitHub repository</a>.
You can test the assistant from here <a href="https://ecommerce-rag.vercel.app/">Assistant</a></p>
<h2 id="1-understanding-rag-for-e-commerce">1. Understanding RAG for E-commerce</h2>
<h3 id="what-is-rag">What is RAG?</h3>
<p>Retrieval-Augmented Generation (RAG) is an AI architecture that enhances large language models (LLMs) by retrieving relevant information from external knowledge sources before generating responses. Unlike traditional LLMs that rely solely on their pre-trained knowledge, RAG systems can access up-to-date, domain-specific information.</p>
<p>The RAG process consists of three main steps:</p>
<ol>
<li><strong>Retrieval</strong>: When a user asks a question, the system searches a database for relevant information</li>
<li><strong>Augmentation</strong>: The retrieved information is added to the prompt sent to the LLM</li>
<li><strong>Generation</strong>: The LLM generates a response based on both its pre-trained knowledge and the retrieved information</li>
</ol>
<h3 id="why-rag-is-perfect-for-e-commerce">Why RAG is Perfect for E-commerce</h3>
<p>E-commerce presents unique challenges that make RAG particularly valuable:</p>
<ul>
<li><strong>Product Catalogs Change Frequently</strong>: New products are added, prices change, and inventory fluctuates</li>
<li><strong>Specific Product Details Matter</strong>: Customers need accurate information about specifications, compatibility, and features</li>
<li><strong>Query Intent is Complex</strong>: &ldquo;Show me a laptop good for gaming under $1000&rdquo; requires understanding multiple constraints</li>
<li><strong>Follow-up Questions are Common</strong>: &ldquo;Does it have a backlit keyboard?&rdquo; requires maintaining context from previous questions</li>
</ul>
<p>Traditional search systems match keywords but struggle with semantic understanding. RAG bridges this gap by combining semantic search with the conversational abilities of LLMs.</p>
<h3 id="rag-vs-traditional-search-in-e-commerce">RAG vs. Traditional Search in E-commerce</h3>
<table>
  <thead>
      <tr>
          <th>Feature</th>
          <th>Traditional Search</th>
          <th>RAG-Based Search</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Query Understanding</td>
          <td>Keyword matching</td>
          <td>Semantic understanding</td>
      </tr>
      <tr>
          <td>Result Relevance</td>
          <td>Based on text similarity</td>
          <td>Based on meaning and context</td>
      </tr>
      <tr>
          <td>Handling Ambiguity</td>
          <td>Limited</td>
          <td>Strong</td>
      </tr>
      <tr>
          <td>Follow-up Questions</td>
          <td>Requires new search</td>
          <td>Maintains context</td>
      </tr>
      <tr>
          <td>Response Format</td>
          <td>List of products</td>
          <td>Conversational with product details</td>
      </tr>
      <tr>
          <td>Product Knowledge</td>
          <td>Limited to indexed fields</td>
          <td>Can include all product details</td>
      </tr>
  </tbody>
</table>
<h2 id="2-vector-databases-and-embeddings">2. Vector Databases and Embeddings</h2>
<h3 id="the-role-of-vector-databases">The Role of Vector Databases</h3>
<p>Vector databases are specialized storage systems designed to efficiently store and query high-dimensional vectors (embeddings). In our e-commerce RAG system, they serve as the foundation for semantic search.</p>
<p>Key features of vector databases include:</p>
<ul>
<li><strong>Similarity Search</strong>: Finding vectors that are semantically similar to a query vector</li>
<li><strong>Efficient Indexing</strong>: Algorithms like HNSW (Hierarchical Navigable Small World) for fast retrieval</li>
<li><strong>Hybrid Search</strong>: Combining vector similarity with traditional filters</li>
<li><strong>Metadata Storage</strong>: Keeping product information alongside vectors</li>
</ul>
<p>For our e-commerce RAG project, we chose Weaviate as our vector database due to its robust features, GraphQL API, and hybrid search capabilities.</p>
<h3 id="creating-product-embeddings">Creating Product Embeddings</h3>
<p>Embeddings are numerical representations of text that capture semantic meaning. In our system, we generate embeddings for product information using Google&rsquo;s text-embedding-004 model.</p>
<p>Here&rsquo;s how we implement the embedding generation in our project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">GoogleGenerativeAI</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@google/generative-ai&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;dotenv&#39;</span>).<span style="color:#a6e22e">config</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Get API key from environment variables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">GEMINI_API_KEY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">GEMINI_API_KEY</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Initialize API client
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">genAI</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GEMINI_API_KEY</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GoogleGenerativeAI</span>(<span style="color:#a6e22e">GEMINI_API_KEY</span>) <span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Generates an embedding vector for the given text
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} text - Text to generate embedding for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {Array} - Embedding vector
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getEmbedding</span>(<span style="color:#a6e22e">text</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">genAI</span>.<span style="color:#a6e22e">getGenerativeModel</span>({ <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;text-embedding-004&#39;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">embedContent</span>(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">embedding</span>.<span style="color:#a6e22e">values</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>These embeddings allow us to convert product descriptions, titles, and features into vectors that can be compared for semantic similarity.</p>
<h3 id="implementing-vector-search">Implementing Vector Search</h3>
<p>With our products embedded in the vector database, we can now implement semantic search. The following code demonstrates how we retrieve relevant products based on a user query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Retrieves product information from Weaviate vector database
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} query - Search query
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {Array} - Product information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getProductInfo</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">query</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">embedding</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getEmbedding</span>(<span style="color:#a6e22e">query</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Use fixed alpha value for vector search
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">alpha</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Clean query text for GraphQL - make it safe
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cleanQuery</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">query</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>) <span style="color:#75715e">// Keep query at reasonable length
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[^\w\s]/gi</span>, <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e">// Remove non-alphanumeric characters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&#34;/g</span>, <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e">// Remove double quotes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      .<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">query</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Get {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Ecommerce (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            hybrid: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              query: &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">cleanQuery</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              alpha: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">alpha</span><span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              vector: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">embedding</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            limit: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          ) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            _additional { score }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }`</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">config</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;post&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">WEAVIATE_URL</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/v1/graphql&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">WEAVIATE_API_KEY</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">axios</span>.<span style="color:#a6e22e">request</span>(<span style="color:#a6e22e">config</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">Get</span>.<span style="color:#a6e22e">Ecommerce</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error during Weaviate query:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>The <code>hybrid</code> parameter in our query allows us to combine vector search (semantic similarity) with keyword matching. The <code>alpha</code> value (0.5) gives equal weight to both approaches, providing a balance between semantic understanding and keyword relevance.</p>
<h2 id="3-conversation-management-and-context">3. Conversation Management and Context</h2>
<h3 id="maintaining-conversation-history">Maintaining Conversation History</h3>
<p>One of the key challenges in building an effective e-commerce assistant is maintaining conversation context. Users often ask follow-up questions that reference previous queries or responses.</p>
<p>In our project, we use MongoDB to store conversation history. Each conversation is stored as a document with an array of messages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Creates a new conversation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} title - Conversation title (optional)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {Promise&lt;Object&gt;} - Created conversation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">createConversation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Assign default title if null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">conversationTitle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">title</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;New Conversation&#39;</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">conversation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Conversation</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">conversationTitle</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">messages</span><span style="color:#f92672">:</span> []
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">save</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">conversation</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error creating conversation:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">error</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Adds a message to a conversation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} conversationId - Conversation ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} role - Message role (user/assistant)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} content - Message content
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {Promise&lt;Object&gt;} - Updated conversation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">addMessageToConversation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">conversationId</span>, <span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">content</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">conversation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">Conversation</span>.<span style="color:#a6e22e">findById</span>(<span style="color:#a6e22e">conversationId</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">conversation</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`Conversation not found with ID: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">conversationId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">role</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">content</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">timestamp</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> Date()
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">updatedAt</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">save</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">conversation</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error adding message to conversation:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">error</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h3 id="detecting-follow-up-questions">Detecting Follow-up Questions</h3>
<p>To provide a seamless conversation experience, our system needs to detect when a user is asking a follow-up question. We use a dedicated classifier agent for this purpose:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Determines if a message is a follow-up question based on conversation history
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Array} conversationHistory - Array of previous conversation messages
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {String} - JSON string indicating if message is a follow-up (true/false)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">classifierAgent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">conversationHistory</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Format conversation history for the AI model
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">formattedHistory</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">conversationHistory</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">msg</span>) =&gt; <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">role</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;User&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Assistant&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">content</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">axios</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;post&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;https://openrouter.ai/api/v1/chat/completions&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">OPENROUTER_API_KEY</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;google/gemini-2.0-flash-001&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messages</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;system&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`You are a sophisticated AI agent specializing in determining if a user&#39;s message is a follow-up question to a previous conversation. A follow-up question is a question that refers to or builds upon a previous question or response in the conversation. For example, if a user asks about a product and then asks about its price, the second question is a follow-up question.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            Analyze the conversation history and determine if the last user message is a follow-up question. Return only a JSON boolean value (true or false) as plain text.`</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Here is the conversation history:\n</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">formattedHistory</span><span style="color:#e6db74">}</span><span style="color:#e6db74">\n\nIs the last user message a follow-up question?`</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">choices</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\n+$/</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;OpenRouter API error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;false&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>When a follow-up question is detected, we expand the search query to include context from previous messages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// If it&#39;s a follow-up question, include previous user questions
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isFollowUp</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">conversationHistory</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Find previous user messages (last 2 user messages)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userMessages</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">conversationHistory</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">msg</span>) =&gt; <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">role</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;user&#39;</span>).<span style="color:#a6e22e">slice</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">userMessages</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">previousUserMessage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">userMessages</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>; <span style="color:#75715e">// Previous user message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">searchQuery</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">translatorAgent</span>(<span style="color:#a6e22e">previousUserMessage</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">translatedMessage</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Expanded search query (follow-up): &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">searchQuery</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;`</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This approach ensures that when a user asks something like &ldquo;What about its battery life?&rdquo; after asking about a specific laptop, our system understands the context and provides relevant information.</p>
<h2 id="4-multi-language-support">4. Multi-language Support</h2>
<h3 id="automatic-language-detection-and-translation">Automatic Language Detection and Translation</h3>
<p>To make our e-commerce assistant accessible to a global audience, we implemented automatic language detection and translation. This allows users to interact with the system in their preferred language while maintaining the semantic search capabilities.</p>
<p>We use a translator agent to convert user queries to English for processing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Translates user messages to English
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} message - User message to translate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {String} - Translated message in English
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">translatorAgent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">message</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">axios</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;post&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;https://openrouter.ai/api/v1/chat/completions&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">OPENROUTER_API_KEY</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;google/gemini-2.0-flash-001&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messages</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;system&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`You are a sophisticated AI agent specializing in translating user queries from multiple languages into English. Before translating, you identify and correct typos, grammatical errors, and punctuation mistakes in the source text to ensure clarity and readability. Your translations should maintain the original context and be culturally nuanced. Return only the translated text as plain text.`</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">choices</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\n+$/</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;OpenRouter API error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">message</span>; <span style="color:#75715e">// Fallback to original message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>The system then responds in the same language as the user&rsquo;s query. This is handled by our AI service, which is instructed to match the language of the input:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messageContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  You are a helpful shopping assistant that can answer questions about products. Based on the user&#39;s question &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">prompt</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;, analyze the product information in the context: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">context</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> and return information only about the most relevant matching product(s). Answer questions related to the </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">category</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> of the product(s). Answer as humanly as possible and in the same language as the </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">prompt</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, but be careful with special names such as brand, model, etc. - don&#39;t translate those.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  // ... additional instructions ...
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>;
</span></span></code></pre></div><h3 id="language-aware-product-information">Language-Aware Product Information</h3>
<p>When displaying product information, we ensure that the system maintains the user&rsquo;s language preference. The AI generates descriptions in the user&rsquo;s language, while preserving brand names, model numbers, and technical specifications.</p>
<p>For example, if a user asks in Turkish: &ldquo;Oyun iÃ§in iyi bir laptop Ã¶nerir misiniz?&rdquo;, the system will:</p>
<ol>
<li>Translate the query to English: &ldquo;Can you recommend a good laptop for gaming?&rdquo;</li>
<li>Perform semantic search using the English query</li>
<li>Retrieve relevant gaming laptops from the vector database</li>
<li>Generate a response in Turkish, describing the gaming laptops while keeping technical terms intact</li>
</ol>
<p>This approach provides a seamless multilingual experience without requiring separate product databases for each language.</p>
<h2 id="5-ai-response-generation">5. AI Response Generation</h2>
<h3 id="contextual-response-generation">Contextual Response Generation</h3>
<p>Once we&rsquo;ve retrieved relevant product information, we need to generate a helpful, contextual response. We use the Gemini API for this purpose, with a fallback to OpenRouter if needed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Generates a response using Gemini or falls back to OpenRouter API
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} prompt - User message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} context - Product information or other context
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} category - Message category
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Array} conversationHistory - Conversation history
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {String} - AI response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">generateGeminiResponse</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">prompt</span>, <span style="color:#a6e22e">context</span>, <span style="color:#a6e22e">category</span>, <span style="color:#a6e22e">conversationHistory</span> <span style="color:#f92672">=</span> []) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Format conversation history for the AI model
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">formattedHistory</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">conversationHistory</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">msg</span>) =&gt; <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">role</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;User&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Assistant&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">content</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messageContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      You are a helpful shopping assistant that can answer questions about products. Based on the user&#39;s question &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">prompt</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;, analyze the product information in the context: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">context</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> and return information only about the most relevant matching product(s). Answer questions related to the </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">category</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> of the product(s). Answer as humanly as possible and in the same language as the </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">prompt</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, but be careful with special names such as brand, model, etc. - don&#39;t translate those.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      If the category is [PRODUCT_INFO] and the question is about general product information (like price, features, specifications etc), include [SHOW_PRODUCT_INFO] at the end of your response so that product information can be formatted and displayed to the user.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      If the question is specifically about product reviews, ratings or customer feedback, do not include [SHOW_PRODUCT_INFO]. Instead, focus on providing a summary of the reviews and ratings from the available data.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      Also consider follow up questions. If the user asks a follow up question about a product mentioned earlier, your answer should be about the SAME product. Do not switch to a different product unless the user explicitly asks about a new product.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      At the end of your response, include a JSON object with an array of product IDs that you referenced in your answer, in the format: [PRODUCT_IDS]{&#34;ids&#34;:[&#34;id1&#34;,&#34;id2&#34;]}[/PRODUCT_IDS]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      Here is the conversation history so far:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">formattedHistory</span><span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      User: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">prompt</span><span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      Assistant:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    `</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Use Gemini API
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">genAI</span>.<span style="color:#a6e22e">getGenerativeModel</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;gemini-2.0-flash&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">systemInstruction</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">messageContent</span>,
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">generateContent</span>(<span style="color:#a6e22e">prompt</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">text</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">geminiError</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Fall back to OpenRouter API if Gemini fails
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Gemini API failed, trying OpenRouter API...&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">openRouterResponse</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">axios</span>.<span style="color:#a6e22e">post</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;https://openrouter.ai/api/v1/chat/completions&#39;</span>,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;anthropic/claude-3-opus:beta&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">messages</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">messageContent</span> }],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">OPENROUTER_API_KEY</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">openRouterResponse</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">choices</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error generating AI response:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;Sorry, an error occurred while generating a response: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">error</span>.<span style="color:#a6e22e">message</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h3 id="product-information-display">Product Information Display</h3>
<p>To enhance the user experience, we format product information in a visually appealing way. The AI response includes a special tag <code>[SHOW_PRODUCT_INFO]</code> when product details should be displayed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Formats product information into HTML for display
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Array} products - Array of product objects
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {String} - HTML formatted product information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">formatProductInfo</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">products</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">products</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">products</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;No relevant product information found.&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">products</span>.<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">products</span>.<span style="color:#a6e22e">message</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">productsHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;products-container&#34;&gt;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">products</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">product</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parsedProduct</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">product</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;string&#39;</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">product</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">product</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">productsHTML</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;div class=&#34;product-card&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;product-image&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;img src=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">thumbnail</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">images</span><span style="color:#f92672">?</span>.[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">               alt=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">title</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;Product Image&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">               loading=&#34;lazy&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;product-info&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;h3 class=&#34;product-title&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">title</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;Name not specified&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/h3&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;p class=&#34;product-description&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">description</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;Description not specified&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;div class=&#34;product-price-container&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;span class=&#34;product-price&#34;&gt;$</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">price</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;Price not specified&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/span&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;a href=&#34;/product/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; class=&#34;product-detail-button&#34; target=&#34;_blank&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            More Details
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/a&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    `</span>;
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">productsHTML</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;&lt;/div&gt;&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">productsHTML</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>The AI can also specify which products to display by including product IDs in its response:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Extract product IDs from AI response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">productIdsMatch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/\[PRODUCT_IDS\](.*?)\[\/PRODUCT_IDS\]/</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">productsToShow</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">productIdsMatch</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get product IDs specified by AI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">productIds</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">productIdsMatch</span>[<span style="color:#ae81ff">1</span>]).<span style="color:#a6e22e">ids</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Filter products to only show those with specified IDs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">productsToShow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">products</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">product</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parsedProduct</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">product</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;string&#39;</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">product</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">product</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">productIds</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">parsedProduct</span>.<span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Remove ID tags from response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\[PRODUCT_IDS\].*?\[\/PRODUCT_IDS\]/</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Show all products if no IDs specified
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">productsToShow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">products</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Format product information and add to response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">productInfo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">productService</span>.<span style="color:#a6e22e">formatProductInfo</span>(<span style="color:#a6e22e">productsToShow</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">productInfo</span>;
</span></span></code></pre></div><p>This approach allows the AI to provide a conversational response while also displaying structured product information when appropriate.</p>
<h2 id="6-message-categorization">6. Message Categorization</h2>
<h3 id="understanding-user-intent">Understanding User Intent</h3>
<p>To provide more relevant responses, we categorize user messages based on their intent. This helps the system determine how to respond and what information to include:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Categorizes user messages into predefined categories
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} message - User message to categorize
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {String} - Category of the message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">categorizerAgent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">message</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">axios</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;post&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;https://openrouter.ai/api/v1/chat/completions&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">OPENROUTER_API_KEY</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;google/gemini-2.0-flash-001&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messages</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;system&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`You are a sophisticated AI agent specializing in categorizing user queries into one of the following categories:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [PRODUCT_INFO] - Questions about product information, features, specifications, price, etc.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [PRODUCT_COMPARISON] - Questions comparing multiple products
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [PRODUCT_RECOMMENDATION] - Questions asking for product recommendations
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [PRODUCT_AVAILABILITY] - Questions about product availability
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [PRODUCT_REVIEWS] - Questions about product reviews or ratings
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [GENERAL_INQUIRY] - General questions not related to specific products
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [CUSTOMER_SERVICE] - Questions about customer service, shipping, returns, etc.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [OTHER] - Any other type of question
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            Return only the category as plain text.`</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">choices</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\n+$/</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;OpenRouter API error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;[GENERAL_INQUIRY]&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>The category is then used to tailor the AI&rsquo;s response. For example, if the category is <code>[PRODUCT_INFO]</code>, the system will include detailed product information in the response.</p>
<h3 id="category-based-response-customization">Category-Based Response Customization</h3>
<p>Different categories of questions require different types of responses. Our system adjusts its behavior based on the detected category:</p>
<ul>
<li><strong>[PRODUCT_INFO]</strong>: Includes detailed product specifications and displays product cards</li>
<li><strong>[PRODUCT_COMPARISON]</strong>: Highlights differences between products</li>
<li><strong>[PRODUCT_RECOMMENDATION]</strong>: Suggests products based on user criteria</li>
<li><strong>[PRODUCT_REVIEWS]</strong>: Focuses on customer feedback and ratings</li>
<li><strong>[GENERAL_INQUIRY]</strong>: Provides general information without specific product details</li>
</ul>
<p>This categorization helps the system provide more relevant and helpful responses to a wide range of user queries.</p>
<h2 id="7-system-architecture-and-implementation">7. System Architecture and Implementation</h2>
<h3 id="clean-architecture-design">Clean Architecture Design</h3>
<p>Our ecommerceRAG project follows a clean architecture pattern with clear separation of concerns:</p>
<ul>
<li><strong>Controllers</strong>: Handle HTTP requests and responses</li>
<li><strong>Services</strong>: Contain business logic and external API interactions</li>
<li><strong>Routes</strong>: Define API endpoints</li>
<li><strong>Utils</strong>: Provide utility functions</li>
<li><strong>Config</strong>: Handle configuration settings</li>
<li><strong>Middlewares</strong>: Implement middleware functions</li>
</ul>
<p>This modular design makes the codebase more maintainable, testable, and scalable.</p>
<h3 id="main-components">Main Components</h3>
<p>The main components of our system include:</p>
<ol>
<li><strong>Chat Controller</strong>: Processes user messages and coordinates the response generation</li>
<li><strong>Vector Service</strong>: Handles interactions with the Weaviate vector database</li>
<li><strong>AI Service</strong>: Manages AI model interactions (Gemini and OpenAI)</li>
<li><strong>Product Service</strong>: Provides product-related services</li>
<li><strong>Conversation Service</strong>: Manages conversation persistence and retrieval</li>
<li><strong>Agent Controller</strong>: Contains agent logic for translation, categorization, and classification</li>
</ol>
<h3 id="processing-flow">Processing Flow</h3>
<p>The main processing flow in our system is handled by the <code>processChat</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Processes chat messages and generates AI responses
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} res - Express response object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">processChat</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> { <span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">conversationId</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">message</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Message is required&#39;</span> });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Categorize the message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">category</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">categorizerAgent</span>(<span style="color:#a6e22e">message</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Get existing conversation or create new one
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">conversation</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">conversationId</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">conversation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversationService</span>.<span style="color:#a6e22e">getConversationById</span>(<span style="color:#a6e22e">conversationId</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">conversation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversationService</span>.<span style="color:#a6e22e">createConversation</span>();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Create a new conversation in case of error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">conversation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversationService</span>.<span style="color:#a6e22e">createConversation</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Add user message to conversation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversationService</span>.<span style="color:#a6e22e">addMessageToConversation</span>(<span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">_id</span>, <span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#a6e22e">message</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Get conversation history (last 4 messages)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">conversationHistory</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversationService</span>.<span style="color:#a6e22e">getConversationMessages</span>(<span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">_id</span>, <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Translate message to English
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">translatedMessage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">translatorAgent</span>(<span style="color:#a6e22e">message</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Determine if message is a follow-up question
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">isFollowUp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">conversationHistory</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Use classifierAgent to determine if it&#39;s a follow-up
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">classifierAgent</span>(<span style="color:#a6e22e">conversationHistory</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parsedResponse</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">response</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">isFollowUp</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">parsedResponse</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Prepare search query
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">searchQuery</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">translatedMessage</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isFollowUp</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">conversationHistory</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Find previous user messages (last 2 user messages)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userMessages</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">conversationHistory</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">msg</span>) =&gt; <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">role</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;user&#39;</span>).<span style="color:#a6e22e">slice</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">userMessages</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">previousUserMessage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">userMessages</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>; <span style="color:#75715e">// Previous user message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">searchQuery</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">translatorAgent</span>(<span style="color:#a6e22e">previousUserMessage</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">translatedMessage</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Get product information from Weaviate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">products</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">vectorService</span>.<span style="color:#a6e22e">getProductInfo</span>(<span style="color:#a6e22e">searchQuery</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Process response based on product information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">products</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">products</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Send product information to AI in JSON format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">productContext</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">products</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Send category and conversation history to AI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">aiService</span>.<span style="color:#a6e22e">generateGeminiResponse</span>(<span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">productContext</span>, <span style="color:#a6e22e">category</span>, <span style="color:#a6e22e">conversationHistory</span>);
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Clean [SHOW_PRODUCT_INFO] tag
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cleanedResponse</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;[SHOW_PRODUCT_INFO]&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversationService</span>.<span style="color:#a6e22e">addMessageToConversation</span>(<span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">_id</span>, <span style="color:#e6db74">&#39;assistant&#39;</span>, <span style="color:#a6e22e">cleanedResponse</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Check if product information should be displayed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;[SHOW_PRODUCT_INFO]&#39;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Process and display product information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// ... (code omitted for brevity)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// If no product information found
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">productInfo</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({ <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;No relevant product information found.&#39;</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">aiService</span>.<span style="color:#a6e22e">generateGeminiResponse</span>(<span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">productInfo</span>, <span style="color:#a6e22e">category</span>, <span style="color:#a6e22e">conversationHistory</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cleanedResponse</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;[SHOW_PRODUCT_INFO]&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">conversationService</span>.<span style="color:#a6e22e">addMessageToConversation</span>(<span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">_id</span>, <span style="color:#e6db74">&#39;assistant&#39;</span>, <span style="color:#a6e22e">cleanedResponse</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Return response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">response</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">response</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">conversationId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">conversation</span>.<span style="color:#a6e22e">_id</span>.<span style="color:#a6e22e">toString</span>(),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">timestamp</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> Date().<span style="color:#a6e22e">toISOString</span>(),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Chat processing error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;An error occurred while processing the message: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">error</span>.<span style="color:#a6e22e">message</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>This function orchestrates the entire process, from receiving a user message to returning an AI-generated response with relevant product information.</p>
<h2 id="8-frontend-integration">8. Frontend Integration</h2>
<h3 id="chat-widget-implementation">Chat Widget Implementation</h3>
<p>To make our RAG system accessible to users, we implemented a chat widget that can be easily integrated into any e-commerce website. The widget is built with vanilla JavaScript and can be added to any page with a simple script tag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://your-domain.com/js/widget.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>The widget provides a clean, intuitive interface for users to interact with our AI assistant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Widget initialization
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">initWidget</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Create widget HTML
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">widgetContainer</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">widgetContainer</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createWidgetHTML</span>();
</span></span><span style="display:flex;"><span>  document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">widgetContainer</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Set up event listeners
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chatForm</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;chachaForm&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messageInput</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;chachaMessageInput&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chatMessages</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;chachaMessages&#39;</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Initialize conversationId as null (no longer using localStorage)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">conversationId</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Add welcome message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">addMessage</span>(<span style="color:#e6db74">&#39;Hello! How can I help you with your shopping today?&#39;</span>, <span style="color:#e6db74">&#39;bot&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Form submission handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">chatForm</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;submit&#39;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">preventDefault</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">messageInput</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">message</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Add user message to chat
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">addMessage</span>(<span style="color:#a6e22e">message</span>, <span style="color:#e6db74">&#39;user&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">messageInput</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">messageInput</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;auto&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Add loading indicator
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">loadingMessage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">addLoadingMessage</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Send message to API
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/api/chat&#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">conversationId</span>,
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Remove loading indicator
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">loadingMessage</span>.<span style="color:#a6e22e">remove</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">ok</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add AI response to chat
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">response</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">addMessage</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">response</span>, <span style="color:#e6db74">&#39;bot&#39;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">message</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">addMessage</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">message</span>, <span style="color:#e6db74">&#39;bot&#39;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">message</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">addMessage</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">message</span>, <span style="color:#e6db74">&#39;bot&#39;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">addMessage</span>(<span style="color:#e6db74">&#39;Sorry, an error occurred. Please try again.&#39;</span>, <span style="color:#e6db74">&#39;bot&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Store conversation ID for future messages
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">conversationId</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">conversationId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">conversationId</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">addMessage</span>(<span style="color:#e6db74">&#39;Sorry, an error occurred. Please try again.&#39;</span>, <span style="color:#e6db74">&#39;bot&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">loadingMessage</span>.<span style="color:#a6e22e">remove</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">addMessage</span>(<span style="color:#e6db74">&#39;Sorry, an error occurred. Please try again.&#39;</span>, <span style="color:#e6db74">&#39;bot&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">###</span> <span style="color:#a6e22e">Responsive</span> <span style="color:#a6e22e">Design</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">The</span> <span style="color:#a6e22e">chat</span> <span style="color:#a6e22e">widget</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">designed</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">responsive</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">work</span> <span style="color:#a6e22e">well</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">both</span> <span style="color:#a6e22e">desktop</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">mobile</span> <span style="color:#a6e22e">devices</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">```javascript
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// Mobile device detection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">const isMobile = window.matchMedia(&#39;(max-width: 480px)&#39;).matches;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// Chat toggle functionality
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chatToggle.addEventListener(&#39;click&#39;, () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  chatContainer.classList.toggle(&#39;collapsed&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  // Prevent body scroll when chat is open on mobile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if (isMobile &amp;&amp; !chatContainer.classList.contains(&#39;collapsed&#39;)) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    document.body.style.overflow = &#39;hidden&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  } else if (isMobile) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    document.body.style.overflow = &#39;&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">});
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// Window resize handler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">window.addEventListener(&#39;resize&#39;, () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  const isMobileNow = window.matchMedia(&#39;(max-width: 480px)&#39;).matches;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  // Update body scroll behavior on resize
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if (isMobileNow &amp;&amp; !chatContainer.classList.contains(&#39;collapsed&#39;)) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    document.body.style.overflow = &#39;hidden&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  } else if (isMobileNow) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    document.body.style.overflow = &#39;&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">});
</span></span></span></code></pre></div><h3 id="html-rendering-and-styling">HTML Rendering and Styling</h3>
<p>The widget includes CSS styles for a clean, modern appearance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>.<span style="color:#a6e22e">chacha-widget</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">fixed</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bottom</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">right</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">z-index</span>: <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">font-family</span>: <span style="color:#e6db74">&#39;Segoe UI&#39;</span>, Tahoma, Geneva, Verdana, <span style="color:#66d9ef">sans-serif</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">chat-toggle</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">60</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">60</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">50</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#2563EB</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">white</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">cursor</span>: <span style="color:#66d9ef">pointer</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">align-items</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">justify-content</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">box-shadow</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">4</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">12</span><span style="color:#66d9ef">px</span> rgba(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.15</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">transition</span>: <span style="color:#66d9ef">all</span> <span style="color:#ae81ff">0.3</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">ease</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">chat-container</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">absolute</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bottom</span>: <span style="color:#ae81ff">80</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">right</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">350</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">500</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">background-color</span>: <span style="color:#66d9ef">white</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">12</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">box-shadow</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">25</span><span style="color:#66d9ef">px</span> rgba(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.2</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">transition</span>: <span style="color:#66d9ef">all</span> <span style="color:#ae81ff">0.3</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">ease</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">overflow</span>: <span style="color:#66d9ef">hidden</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Additional styles omitted for brevity */</span>
</span></span></code></pre></div><p>The widget dynamically renders HTML for messages and product cards, providing a rich user experience.</p>
<h2 id="9-testing-and-evaluation">9. Testing and Evaluation</h2>
<h3 id="api-testing-with-postman">API Testing with Postman</h3>
<p>To ensure our system works correctly, we created a comprehensive Postman collection for testing all endpoints:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;info&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;ecommerceRAG API&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A collection for testing the ecommerceRAG API endpoints&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;schema&#34;</span>: <span style="color:#e6db74">&#34;https://schema.getpostman.com/json/collection/v2.1.0/collection.json&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;item&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Chat&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Endpoints for chat functionality&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;item&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Process Chat Message&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;request&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;header&#34;</span>: [
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Content-Type&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;body&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;raw&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;raw&#34;</span>: <span style="color:#e6db74">&#34;{\n    \&#34;message\&#34;: \&#34;What laptops do you have?\&#34;,\n    \&#34;conversationId\&#34;: null\n}&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;url&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;raw&#34;</span>: <span style="color:#e6db74">&#34;{{baseUrl}}/api/chat&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;host&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;{{baseUrl}}&#34;</span>
</span></span><span style="display:flex;"><span>              ],
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;path&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;api&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;chat&#34;</span>
</span></span><span style="display:flex;"><span>              ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Process a chat message and get a response from the AI&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Process Follow-up Message&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;request&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;header&#34;</span>: [
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;Content-Type&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;body&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;raw&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;raw&#34;</span>: <span style="color:#e6db74">&#34;{\n    \&#34;message\&#34;: \&#34;What is the price range?\&#34;,\n    \&#34;conversationId\&#34;: \&#34;{{conversationId}}\&#34;\n}&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;url&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;raw&#34;</span>: <span style="color:#e6db74">&#34;{{baseUrl}}/api/chat&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;host&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;{{baseUrl}}&#34;</span>
</span></span><span style="display:flex;"><span>              ],
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;path&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;api&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;chat&#34;</span>
</span></span><span style="display:flex;"><span>              ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Process a follow-up message in an existing conversation&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Conversations&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Endpoints for managing conversations&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;item&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Get All Conversations&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;request&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;GET&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;url&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;raw&#34;</span>: <span style="color:#e6db74">&#34;{{baseUrl}}/api/conversations&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;host&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;{{baseUrl}}&#34;</span>
</span></span><span style="display:flex;"><span>              ],
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;path&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;api&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;conversations&#34;</span>
</span></span><span style="display:flex;"><span>              ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Get a list of all conversations&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Additional endpoints omitted for brevity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Products&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Endpoints for product information&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;item&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Get Product Detail&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;request&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;GET&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;url&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;raw&#34;</span>: <span style="color:#e6db74">&#34;{{baseUrl}}/product/{{productId}}&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;host&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;{{baseUrl}}&#34;</span>
</span></span><span style="display:flex;"><span>              ],
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&#34;path&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;product&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;{{productId}}&#34;</span>
</span></span><span style="display:flex;"><span>              ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Get detailed information about a specific product&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="performance-evaluation">Performance Evaluation</h3>
<p>We evaluated our system on several key metrics:</p>
<ol>
<li><strong>Response Time</strong>: The average time to generate a response</li>
<li><strong>Relevance</strong>: How well the retrieved products match the user query</li>
<li><strong>Conversation Coherence</strong>: How well the system maintains context in follow-up questions</li>
<li><strong>Language Support</strong>: Accuracy of responses in different languages</li>
</ol>
<p>Our testing showed that the system performs well across these metrics, with particularly strong results in maintaining conversation context and providing relevant product information.</p>
<h2 id="10-future-improvements">10. Future Improvements</h2>
<p>While our current implementation provides a solid foundation for an e-commerce RAG system, there are several areas for future improvement:</p>
<h3 id="personalization">Personalization</h3>
<p>Future versions could incorporate user preferences and purchase history to provide more personalized recommendations. This would involve:</p>
<ul>
<li>Tracking user interactions and preferences</li>
<li>Incorporating user profile information in the RAG process</li>
<li>Adjusting product rankings based on user history</li>
</ul>
<h3 id="enhanced-product-comparison">Enhanced Product Comparison</h3>
<p>We could improve the system&rsquo;s ability to compare products by:</p>
<ul>
<li>Implementing structured product attribute extraction</li>
<li>Creating specialized prompts for comparison queries</li>
<li>Developing visual comparison displays</li>
</ul>
<h3 id="voice-interface">Voice Interface</h3>
<p>Adding voice input and output would make the system more accessible and convenient, especially for mobile users:</p>
<ul>
<li>Implementing speech-to-text for user queries</li>
<li>Adding text-to-speech for AI responses</li>
<li>Supporting voice-specific interaction patterns</li>
</ul>
<h3 id="analytics-and-feedback-loop">Analytics and Feedback Loop</h3>
<p>Implementing analytics would help improve the system over time:</p>
<ul>
<li>Tracking successful vs. unsuccessful interactions</li>
<li>Analyzing common user queries and pain points</li>
<li>Using feedback to fine-tune the RAG process</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>In this article, we&rsquo;ve explored how Retrieval-Augmented Generation (RAG) can transform e-commerce applications by providing more intelligent, context-aware product search and recommendations. We&rsquo;ve implemented a complete RAG system that combines vector databases, semantic search, conversation memory, and multi-language support to create a powerful shopping assistant.</p>
<p>The key components of our system include:</p>
<ul>
<li><strong>Vector Database</strong>: Storing product embeddings for semantic search</li>
<li><strong>Conversation Management</strong>: Maintaining context for follow-up questions</li>
<li><strong>Multi-language Support</strong>: Allowing users to interact in their preferred language</li>
<li><strong>AI Response Generation</strong>: Creating helpful, contextual responses</li>
<li><strong>Message Categorization</strong>: Understanding user intent</li>
<li><strong>Clean Architecture</strong>: Ensuring maintainability and scalability</li>
</ul>
<p>By combining these components, we&rsquo;ve created a system that can understand complex product queries, maintain conversation context, and provide accurate, helpful responses across multiple languages.</p>
<p>You can access the complete code for this project at <a href="https://github.com/cagatayturkan/ecommerceRAG">GitHub repository</a> and use it as a starting point for your own RAG-based applications.</p>
<hr>
<pre tabindex="0"><code>
Bu blog yazÄ±sÄ±, ecommerceRAG projenizi detaylÄ± bir ÅŸekilde anlatÄ±yor ve RAG teknolojisinin e-ticaret uygulamalarÄ±nda nasÄ±l kullanÄ±labileceÄŸini kapsamlÄ± bir ÅŸekilde aÃ§Ä±klÄ±yor. YazÄ±, sizin blog yazÄ±m tarzÄ±nÄ±zÄ± takip ederek:

1. Teorik bilgileri aÃ§Ä±k ve anlaÅŸÄ±lÄ±r bir ÅŸekilde sunuyor
2. Kod Ã¶rnekleriyle pratik uygulamalarÄ± gÃ¶steriyor
3. Projenin mimari yapÄ±sÄ±nÄ± ve modÃ¼ler tasarÄ±mÄ±nÄ± aÃ§Ä±klÄ±yor
4. VektÃ¶r veritabanlarÄ±, semantik arama ve konuÅŸma baÄŸlamÄ± gibi Ã¶nemli konularÄ± detaylandÄ±rÄ±yor
5. Ã‡ok dilli destek ve otomatik Ã§eviri Ã¶zelliklerini vurguluyor
6. Gelecekteki geliÅŸtirme alanlarÄ±nÄ± belirtiyor

Markdown formatÄ±nda hazÄ±rlanmÄ±ÅŸ bu yazÄ±yÄ± blog sitenize ekleyebilir ve gerekirse iÃ§eriÄŸi kendi ihtiyaÃ§larÄ±nÄ±za gÃ¶re dÃ¼zenleyebilirsiniz.
</code></pre>
            </div>
        </div>
    </div>
    <div class="my-10 py-5 border-t border-dashed border-t-white/10 text-xl text-gray-600">
        
    </div>
</article>


            </main>

            <aside id="sidebar" class="aside-container">

    
    <div class="aside-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
        </svg>
        About
    </div>

    <img src="/blog/images/bg.jpg" class="w-80 self-center rounded-lg" alt="Logo" />

    
    <div class="aside-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
        </svg>
        Latest Post
    </div>

    <ul class="text-lg">
        
        
        <li class="leading-10 line-clamp-1 mb-3 font-light border-b border-b-white/10 border-dashed">
            <a href="/blog/en/building-intelligent-ecommerce-rag-copy/" class="py-5 hover:text-gray-300">Building Intelligent E-commerce Experiences with RAG</a>
        </li>
        
        
        
        <li class="leading-10 line-clamp-1 mb-3 font-light border-b border-b-white/10 border-dashed">
            <a href="/blog/en/building-intelligent-ecommerce-rag/" class="py-5 hover:text-gray-300">Building Intelligent E-commerce Experiences with RAG</a>
        </li>
        
        
        
        <li class="leading-10 line-clamp-1 mb-3 font-light border-b border-b-white/10 border-dashed">
            <a href="/blog/en/rag-building-next-gen-ai-systems/" class="py-5 hover:text-gray-300">RAG: Building Next-Generation AI Systems with Retrieval Augmented Generation</a>
        </li>
        
        
        
        <li class="leading-10 line-clamp-1 mb-3 font-light border-b border-b-white/10 border-dashed">
            <a href="/blog/en/modern-ai-technologies-nodejs-integrations/" class="py-5 hover:text-gray-300">Modern AI Technologies and Node.js Integration</a>
        </li>
        
        
        
        <li class="leading-10 line-clamp-1 mb-3 font-light border-b border-b-white/10 border-dashed">
            <a href="/blog/en/build-restful-api-with-fastify-nodejs/" class="py-5 hover:text-gray-300">Build a RESTful API with Fastify and Node.js</a>
        </li>
        
        
    </ul>

    
    <div class="aside-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M2.25 7.125C2.25 6.504 2.754 6 3.375 6h6c.621 0 1.125.504 1.125 1.125v3.75c0 .621-.504 1.125-1.125 1.125h-6a1.125 1.125 0 0 1-1.125-1.125v-3.75ZM14.25 8.625c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v8.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 0 1-1.125-1.125v-8.25ZM3.75 16.125c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 0 1-1.125-1.125v-2.25Z" />
        </svg>
        Hot Categories
    </div>
    <ul class="leading-10 text-lg">
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/typescript/" class="hover:text-gray-300">TypeScript <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">9</span></a>
        </li>
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/ai/" class="hover:text-gray-300">AI <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">4</span></a>
        </li>
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/node.js/" class="hover:text-gray-300">Node.js <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">3</span></a>
        </li>
        
        
        
        
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/backend/" class="hover:text-gray-300">Backend <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/git/" class="hover:text-gray-300">Git <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/development/" class="hover:text-gray-300">Development <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/ios/" class="hover:text-gray-300">IOS <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/javascript/" class="hover:text-gray-300">JavaScript <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        
        
        <li class="mb-1 border-b border-b-gray-900 border-dashed font-light">
            <a href="/blog/en/categories/linux/" class="hover:text-gray-300">Linux <span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        

    </ul>

    
    <div class="aside-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
        </svg>
        Top Tags
    </div>
    <div class="flex flex-wrap gap-2 text-lg leading-8 pt-3 pl-1">
        
        
        
        
        <a href="/blog/en/tags/typescript/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Typescript&nbsp;&nbsp;9</span></a>
        
        
        
        <a href="/blog/en/tags/nodejs/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Nodejs&nbsp;&nbsp;5</span></a>
        
        
        
        <a href="/blog/en/tags/rag/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Rag&nbsp;&nbsp;3</span></a>
        
        
        
        <a href="/blog/en/tags/vectordb/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Vectordb&nbsp;&nbsp;3</span></a>
        
        
        
        <a href="/blog/en/tags/ai/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Ai&nbsp;&nbsp;3</span></a>
        
        
        
        <a href="/blog/en/tags/javascript/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Javascript&nbsp;&nbsp;3</span></a>
        
        
        
        <a href="/blog/en/tags/embeddings/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Embeddings&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/git-flow/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Git-Flow&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/classes/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Classes&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/compiler/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Compiler&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/jwt/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Jwt&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/object-types/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Object-Types&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/terminal/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Terminal&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/functions/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Functions&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/commands/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Commands&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/configuration/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Configuration&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/llm/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Llm&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/microservices/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Microservices&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/type-safety/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Type-Safety&nbsp;&nbsp;1</span></a>
        
        
        
        <a href="/blog/en/tags/api/"><span
                class="inline-block p-0 bg-gray-800 hover:bg-gray-900 border border-gray-800 text-gray-500 hover:text-gray-300 font-light mb-1 px-5 rounded-full hover:scale-105">Api&nbsp;&nbsp;1</span></a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>

    
    <div class="aside-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
        </svg>
        Archive Analytics
    </div>
    <ul class="leading-10 text-lg font-light">
        
        
        
        
        <li class="mb-1 border-b border-b-white/10 border-dashed">
            <a href="/blog/en/archives">Mar 2025<span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">4</span></a>
        </li>
        
        
        
        <li class="mb-1 border-b border-b-white/10 border-dashed">
            <a href="/blog/en/archives">Feb 2025<span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">11</span></a>
        </li>
        
        
        
        <li class="mb-1 border-b border-b-white/10 border-dashed">
            <a href="/blog/en/archives">Jan 2025<span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        <li class="mb-1 border-b border-b-white/10 border-dashed">
            <a href="/blog/en/archives">Mar 2024<span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
        <li class="mb-1 border-b border-b-white/10 border-dashed">
            <a href="/blog/en/archives">Nov 2023<span
                    class="ml-2 px-2 bg-gray-800 rounded-full text-gray-500">1</span></a>
        </li>
        
        
        
    </ul>

    
    <div class="aside-section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
        </svg>
        Contact
    </div>
    <div class="flex flex-row gap-2">
        Emailï¼šcagatayturkann@gmail.com
    </div>
</aside>
        </div>
    </div>
    </script>
</body>

</html>