<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <!-- Background -->
  <rect width="900" height="700" fill="#f9f9f9" rx="10" ry="10"/>
  
  <!-- Title -->
  <text x="450" y="40" font-family="Arial, sans-serif" font-size="24" text-anchor="middle" font-weight="bold" fill="#333">Multi-Stage Retrieval Process</text>
  <text x="450" y="70" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#666">With Filters and Re-ranking</text>
  
  <!-- Database Icon -->
  <rect x="400" y="100" width="100" height="60" rx="5" ry="5" fill="#e1f5fe" stroke="#0288d1" stroke-width="2"/>
  <text x="450" y="135" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Document Store</text>
  <path d="M425,110 L425,120 L475,120 L475,110" stroke="#0288d1" stroke-width="1.5" fill="none"/>
  <path d="M425,125 L425,135 L475,135 L475,125" stroke="#0288d1" stroke-width="1.5" fill="none"/>
  <path d="M425,140 L425,150 L475,150 L475,140" stroke="#0288d1" stroke-width="1.5" fill="none"/>
  
  <!-- User Query -->
  <rect x="100" y="200" width="150" height="60" rx="30" ry="30" fill="#fff8e1" stroke="#ffa000" stroke-width="2"/>
  <text x="175" y="235" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">User Query</text>
  
  <!-- Query Processing -->
  <rect x="100" y="320" width="150" height="60" rx="5" ry="5" fill="#e8f5e9" stroke="#43a047" stroke-width="2"/>
  <text x="175" y="345" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Query</text>
  <text x="175" y="365" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Pre-processing</text>
  
  <!-- Stage 1: Initial Retrieval -->
  <rect x="350" y="200" width="200" height="80" rx="5" ry="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="450" y="225" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" font-weight="bold">Stage 1</text>
  <text x="450" y="250" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Initial Retrieval</text>
  <text x="450" y="270" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">(BM25, Dense, Hybrid)</text>
  
  <!-- Initial Results Pool -->
  <rect x="375" y="320" width="150" height="60" rx="5" ry="5" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
  <text x="450" y="345" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Initial Result Pool</text>
  <text x="450" y="365" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">(500-1000 docs)</text>
  
  <!-- Stage 2: Filtering -->
  <rect x="350" y="420" width="200" height="80" rx="5" ry="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="450" y="445" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" font-weight="bold">Stage 2</text>
  <text x="450" y="470" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Content-Based Filtering</text>
  <text x="450" y="490" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">(Metadata, Date, Source)</text>
  
  <!-- Filtered Results -->
  <rect x="375" y="540" width="150" height="60" rx="5" ry="5" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
  <text x="450" y="565" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Filtered Result Set</text>
  <text x="450" y="585" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">(100-200 docs)</text>
  
  <!-- Stage 3: Re-ranking -->
  <rect x="650" y="420" width="200" height="80" rx="5" ry="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="750" y="445" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" font-weight="bold">Stage 3</text>
  <text x="750" y="470" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Neural Re-ranking</text>
  <text x="750" y="490" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">(Cross-Encoder, LLM)</text>
  
  <!-- Final Results -->
  <rect x="675" y="540" width="150" height="60" rx="5" ry="5" fill="#ede7f6" stroke="#673ab7" stroke-width="2"/>
  <text x="750" y="565" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Final Ranked Results</text>
  <text x="750" y="585" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#666">(Top 10-50 docs)</text>
  
  <!-- Post-Processing -->
  <rect x="675" y="640" width="150" height="60" rx="5" ry="5" fill="#ffebee" stroke="#d32f2f" stroke-width="2"/>
  <text x="750" y="675" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Result Presentation</text>
  
  <!-- Performance Metrics Box -->
  <rect x="50" y="600" width="200" height="80" rx="5" ry="5" fill="#fce4ec" stroke="#ec407a" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="150" y="625" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold">Performance Metrics</text>
  <text x="150" y="650" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">• Precision / Recall</text>
  <text x="150" y="670" font-family="Arial, sans-serif" font-size="12" text-anchor="middle">• NDCG / MAP</text>
  
  <!-- Feedback Loop -->
  <path d="M750,640 L750,620 L850,620 L850,500 L830,500" stroke="#e65100" stroke-width="2" stroke-dasharray="6,3" fill="none"/>
  <polygon points="830,494 820,500 830,506" fill="#e65100"/>
  <text x="850" y="580" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" transform="rotate(90, 850, 580)" fill="#e65100">Feedback Loop</text>
  
  <!-- Arrows -->
  <!-- Database to Stage 1 -->
  <line x1="450" y1="160" x2="450" y2="200" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- User Query to Query Processing -->
  <line x1="175" y1="260" x2="175" y2="320" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Query Processing to Stage 1 -->
  <path d="M250,350 L300,350 L300,240 L350,240" stroke="#555" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Stage 1 to Initial Results -->
  <line x1="450" y1="280" x2="450" y2="320" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Initial Results to Filtering -->
  <line x1="450" y1="380" x2="450" y2="420" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Filtering to Filtered Results -->
  <line x1="450" y1="500" x2="450" y2="540" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Filtered Results to Re-ranking -->
  <path d="M525,570 L600,570 L600,460 L650,460" stroke="#555" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Re-ranking to Final Results -->
  <line x1="750" y1="500" x2="750" y2="540" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Final Results to Post-Processing -->
  <line x1="750" y1="600" x2="750" y2="640" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Filtered Results to Performance Metrics -->
  <path d="M375,570 L250,570 L250,600" stroke="#ec407a" stroke-width="1.5" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowheadPink)"/>
  
  <!-- Final Results to Performance Metrics -->
  <path d="M675,570 L550,570 L550,630 L250,630" stroke="#ec407a" stroke-width="1.5" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowheadPink)"/>
  
  <!-- Performance Metrics to Stage 1 (Optimization) -->
  <path d="M150,600 L150,550 L330,550 L330,260 L350,260" stroke="#ec407a" stroke-width="1.5" stroke-dasharray="5,3" fill="none" marker-end="url(#arrowheadPink)"/>
  <text x="240" y="540" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#ec407a">System Optimization</text>
  
  <!-- Arrowhead definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
    <marker id="arrowheadPink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ec407a"/>
    </marker>
  </defs>
  
  <!-- Legend -->
  <rect x="700" y="100" width="180" height="170" rx="5" ry="5" fill="white" stroke="#ccc" stroke-width="1.5"/>
  <text x="790" y="125" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" font-weight="bold">Legend</text>
  
  <!-- Legend Items -->
  <rect x="715" y="140" width="20" height="20" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5"/>
  <text x="745" y="155" font-family="Arial, sans-serif" font-size="12" text-anchor="start">Processing Stage</text>
  
  <rect x="715" y="170" width="20" height="20" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1.5"/>
  <text x="745" y="185" font-family="Arial, sans-serif" font-size="12" text-anchor="start">Result Set</text>
  
  <rect x="715" y="200" width="20" height="20" fill="#fff8e1" stroke="#ffa000" stroke-width="1.5" rx="10" ry="10"/>
  <text x="745" y="215" font-family="Arial, sans-serif" font-size="12" text-anchor="start">Input/Starting Point</text>
  
  <line x1="715" y1="240" x2="735" y2="240" stroke="#ec407a" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="745" y="245" font-family="Arial, sans-serif" font-size="12" text-anchor="start">Evaluation Flow</text>
</svg>